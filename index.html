<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Staff Checklist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
    <div class="max-w-4xl mx-auto p-6 bg-blue-50 min-h-screen">
        <div class="bg-white rounded-lg shadow-xl p-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">
                Restaurant Staff Checklist
            </h1>
            
            <div class="flex justify-center mb-6">
                <input
                    type="text"
                    id="staffName"
                    placeholder="Enter your name"
                    class="px-4 py-3 border border-gray-300 rounded-lg text-lg"
                />
            </div>
            
            <div class="flex justify-center mb-6">
                <span class="text-gray-600">Report will be sent to: chang.yoonho@gmail.com</span>
            </div>

            <div class="mb-6">
                <div class="flex justify-between mb-2">
                    <span id="progressText">Progress: 0/12 tasks</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progressBar" class="bg-green-500 h-3 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <div id="tasksContainer"></div>

            <div class="text-center mt-8">
                <button
                    id="sendButton"
                    onclick="sendReport()"
                    class="px-6 py-3 rounded-lg font-medium bg-blue-600 hover:bg-blue-700 text-white"
                >
                    Send Progress Report
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initial data
        let tasks = [
            { id: 1, category: 'Opening', task: 'Turn on all lights and equipment', completed: false, photo: null, time: null },
            { id: 2, category: 'Opening', task: 'Check temperature of refrigerators/freezers', completed: false, photo: null, time: null },
            { id: 3, category: 'Opening', task: 'Set up dining area (tables, chairs, napkins)', completed: false, photo: null, time: null },
            { id: 4, category: 'Kitchen', task: 'Prepare ingredients for daily specials', completed: false, photo: null, time: null },
            { id: 5, category: 'Kitchen', task: 'Check food expiration dates', completed: false, photo: null, time: null },
            { id: 6, category: 'Kitchen', task: 'Clean and sanitize work surfaces', completed: false, photo: null, time: null },
            { id: 7, category: 'Service', task: 'Stock napkins, utensils, and condiments', completed: false, photo: null, time: null },
            { id: 8, category: 'Service', task: 'Check POS system and printers', completed: false, photo: null, time: null },
            { id: 9, category: 'Cleaning', task: 'Wipe down all tables and chairs', completed: false, photo: null, time: null },
            { id: 10, category: 'Cleaning', task: 'Clean restrooms and restock supplies', completed: false, photo: null, time: null },
            { id: 11, category: 'Closing', task: 'Count cash register and prepare deposit', completed: false, photo: null, time: null },
            { id: 12, category: 'Closing', task: 'Turn off all equipment and lights', completed: false, photo: null, time: null }
        ];

        let isLoading = false;
        const managerEmail = 'chang.yoonho@gmail.com';

        // Initialize EmailJS
        emailjs.init('pxPMV9MhBRrIIDzvS');

        // Execute when page loads
        document.addEventListener('DOMContentLoaded', function() {
            renderTasks();
            updateProgress();
        });

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                task.time = task.completed ? new Date().toLocaleTimeString() : null;
                renderTasks();
                updateProgress();
            }
        }

        function handlePhotoUpload(id, event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const task = tasks.find(t => t.id === id);
                    if (task) {
                        task.photo = e.target.result;
                        renderTasks();
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function updateProgress() {
            const completedTasks = tasks.filter(task => task.completed).length;
            const totalTasks = tasks.length;
            const percentage = (completedTasks / totalTasks) * 100;

            document.getElementById('progressText').textContent = `Progress: ${completedTasks}/${totalTasks} tasks`;
            document.getElementById('progressPercent').textContent = `${percentage.toFixed(1)}%`;
            document.getElementById('progressBar').style.width = `${percentage}%`;

            const sendButton = document.getElementById('sendButton');
            if (completedTasks === totalTasks) {
                sendButton.textContent = 'Send Complete Report';
                sendButton.className = 'px-6 py-3 rounded-lg font-medium bg-green-600 hover:bg-green-700 text-white';
            } else {
                sendButton.textContent = 'Send Progress Report';
                sendButton.className = 'px-6 py-3 rounded-lg font-medium bg-blue-600 hover:bg-blue-700 text-white';
            }
        }

        function renderTasks() {
            const container = document.getElementById('tasksContainer');
            const categories = ['Opening', 'Kitchen', 'Service', 'Cleaning', 'Closing'];
            
            container.innerHTML = '';

            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'mb-6';
                
                const categoryTasks = tasks.filter(task => task.category === category);
                
                let categoryHTML = `
                    <h2 class="text-xl font-semibold mb-3 p-2 bg-gray-100 rounded">
                        ${category}
                    </h2>
                `;

                categoryTasks.forEach(task => {
                    categoryHTML += `
                        <div class="p-4 mb-3 rounded border-2 ${
                            task.completed ? 'bg-green-50 border-green-200' : 'bg-white border-gray-200'
                        }">
                            <div class="flex justify-between mb-2">
                                <div class="flex items-center">
                                    <button onclick="toggleTask(${task.id})" class="mr-3 text-2xl">
                                        ${task.completed ? '‚úÖ' : '‚≠ï'}
                                    </button>
                                    <span class="${task.completed ? 'line-through text-green-700' : ''}">
                                        ${task.task}
                                    </span>
                                </div>
                                ${task.time ? `<span class="text-sm text-green-600">‚úì ${task.time}</span>` : ''}
                            </div>
                            
                            <div class="ml-10">
                                <input
                                    type="file"
                                    accept="image/*"
                                    onchange="handlePhotoUpload(${task.id}, event)"
                                    style="display: none;"
                                    id="file-${task.id}"
                                />
                                <button
                                    onclick="document.getElementById('file-${task.id}').click()"
                                    class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full mr-3"
                                >
                                    üì∑ Add Photo
                                </button>
                                
                                ${task.photo ? `
                                    <div>
                                        <span class="text-green-600">‚úÖ Photo uploaded</span>
                                        <br>
                                        <img src="${task.photo}" alt="Task photo" class="mt-2 max-w-xs max-h-32 rounded border" />
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                
                categoryDiv.innerHTML = categoryHTML;
                container.appendChild(categoryDiv);
            });
        }

        async function sendReport() {
            const staffName = document.getElementById('staffName').value;
            
            if (!staffName.trim()) {
                alert('Please enter your name before sending the report.');
                return;
            }

            if (isLoading) return;
            
            isLoading = true;
            const sendButton = document.getElementById('sendButton');
            sendButton.textContent = 'Sending...';
            sendButton.className = 'px-6 py-3 rounded-lg font-medium bg-gray-400 cursor-not-allowed text-white';

            try {
                const completedTasks = tasks.filter(task => task.completed);
                const incompleteTasks = tasks.filter(task => !task.completed);
                const totalTasks = tasks.length;
                const completedCount = completedTasks.length;
                const progressPercentage = (completedCount / totalTasks) * 100;

                const templateParams = {
                    to_email: managerEmail,
                    from_name: staffName,
                    report_date: new Date().toLocaleDateString('en-US'),
                    total_tasks: totalTasks,
                    completed_tasks: completedCount,
                    completion_rate: `${progressPercentage.toFixed(1)}%`,
                    completed_list: completedTasks.length > 0 
                        ? completedTasks.map(task => `‚úì ${task.task} (${task.time})`).join('\n')
                        : 'No completed tasks',
                    incomplete_list: incompleteTasks.length > 0
                        ? incompleteTasks.map(task => `‚úó ${task.task}`).join('\n')
                        : 'No incomplete tasks',
                    photos_count: tasks.filter(task => task.photo).length
                };

                await emailjs.send('service_oc0qw5r', 'template_w8xps0u', templateParams);
                alert(`‚úÖ Report successfully sent to ${managerEmail}!`);

            } catch (error) {
                console.error('Email sending failed:', error);
                alert(`‚ùå Email sending failed: ${error.message || 'Please check your network connection.'}`);
            } finally {
                isLoading = false;
                updateProgress(); // Restore button state
            }
        }
    </script>
</body>
</html>